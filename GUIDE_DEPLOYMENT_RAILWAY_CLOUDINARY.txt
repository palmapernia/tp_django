â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    GUIDE COMPLET DE DÃ‰PLOIEMENT SUR RAILWAY + CLOUDINARY
                            Projet Django TP - Blog + Polls + Auth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ SOMMAIRE :
1. PrÃ©paration pour la production
2. Configuration de Railway (MySQL)
3. Configuration de Cloudinary (Stockage d'images)
4. DÃ©ploiement et rÃ©solution des problÃ¨mes
5. Fichiers crÃ©Ã©s et modifiÃ©s

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ—ï¸ 1. PRÃ‰PARATION POUR LA PRODUCTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1.1. Installation des packages de production :
   poetry add gunicorn
   poetry add whitenoise
   poetry add mysqlclient
   poetry add dj-database-url

1.2. Configuration dans settings.py pour la production :

   ğŸ“ Fichier : tp_django/settings.py
   
   ğŸ”¸ Ã‰TAPE 1 : Ajouter les imports en haut du fichier (aprÃ¨s les imports existants)
   import os
   import dj_database_url

   ğŸ”¸ Ã‰TAPE 2 : Remplacer les lignes de sÃ©curitÃ© existantes par :
   # SÃ©curitÃ© (remplacer SECRET_KEY et DEBUG existants)
   SECRET_KEY = os.environ.get('SECRET_KEY', 'django-insecure-fallback')
   DEBUG = os.environ.get('DEBUG', 'True') == 'True'
   ALLOWED_HOSTS = os.environ.get('ALLOWED_HOSTS', '').split(',') if os.environ.get('ALLOWED_HOSTS') else []

   ğŸ”¸ Ã‰TAPE 3 : Ajouter aprÃ¨s ALLOWED_HOSTS :
   # Configuration CSRF pour Railway
   CSRF_TRUSTED_ORIGINS = os.environ.get('CSRF_TRUSTED_ORIGINS', '').split(',') if os.environ.get('CSRF_TRUSTED_ORIGINS') else [
       'http://127.0.0.1:8000', 
       'http://localhost:8000'
   ]

   ğŸ”¸ Ã‰TAPE 4 : Remplacer complÃ¨tement la section DATABASES par :
   # Base de donnÃ©es MySQL avec Railway
   if os.environ.get('MYSQL_URL'):
       DATABASES = {
           'default': dj_database_url.parse(os.environ.get('MYSQL_URL'))
       }
   else:
       # Configuration dÃ©veloppement local
       DATABASES = {
           'default': {
               'ENGINE': 'django.db.backends.mysql',
               'NAME': os.environ.get('MYSQLDATABASE', 'tp_django_db'),
               'USER': os.environ.get('MYSQLUSER', 'root'),
               'PASSWORD': os.environ.get('MYSQLPASSWORD', 'root'),
               'HOST': os.environ.get('MYSQLHOST', 'mysql'),
               'PORT': os.environ.get('MYSQLPORT', '3306'),
           }
       }

   ğŸ”¸ Ã‰TAPE 5 : Dans la liste MIDDLEWARE, ajouter aprÃ¨s SecurityMiddleware :
   MIDDLEWARE = [
       'django.middleware.security.SecurityMiddleware',
       'whitenoise.middleware.WhiteNoiseMiddleware',  # â† AJOUTER cette ligne
       # ... garder les autres middlewares existants
   ]

   ğŸ”¸ Ã‰TAPE 6 : Modifier la section des fichiers statiques :
   # Trouver STATIC_ROOT et le remplacer/ajouter :
   STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
   
   # Ajouter cette condition :
   if not DEBUG:
       STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'
   else:
       STATICFILES_STORAGE = 'django.contrib.staticfiles.storage.StaticFilesStorage'

1.3. Configuration pour le dÃ©veloppement local avec Cloudinary :

   ğŸ”¸ Ã‰TAPE 1 : Installer python-dotenv pour les variables d'environnement locales
   ğŸ“ Terminal :
   poetry add python-dotenv

   ğŸ”¸ Ã‰TAPE 2 : CrÃ©er fichier .env (Ã  la racine du projet Django)
   ğŸ“ Emplacement : /workspace/projets/tp_django/.env
   CLOUDINARY_CLOUD_NAME=dnlraecua
   CLOUDINARY_API_KEY=635285162275731
   CLOUDINARY_API_SECRET=qhOM0uYjiEfCFRuNWwAB1-9a9d4
   DEBUG=True
   SECRET_KEY=django-insecure-local-key-for-development

   ğŸ”¸ Ã‰TAPE 3 : Modifier settings.py pour charger le fichier .env
   ğŸ“ Fichier : tp_django/settings.py
   ğŸ“ Ajouter au dÃ©but (aprÃ¨s from pathlib import Path) :
   
   # Cargar variables de entorno desde .env (solo en desarrollo)
   try:
       from dotenv import load_dotenv
       load_dotenv()
   except ImportError:
       pass  # En producciÃ³n no necesita dotenv

   ğŸ”¸ Ã‰TAPE 4 : CrÃ©er/modifier .gitignore
   ğŸ“ Emplacement : /workspace/projets/tp_django/.gitignore
   ğŸ“ Ajouter :
   .env

1.4. CrÃ©ation des fichiers de dÃ©ploiement :

   ğŸ”¸ CRÃ‰ER : requirements.txt (Ã  la racine du projet Django)
   ğŸ“ Emplacement : /workspace/projets/tp_django/requirements.txt
   Django==5.2.8
   djangorestframework==3.15.2
   djangorestframework-simplejwt==5.3.1
   drf-spectacular==0.27.2
   django-debug-toolbar==4.4.6
   gunicorn==21.2.0
   whitenoise==6.8.2
   mysqlclient==2.2.6
   coverage==7.6.10
   Pillow==11.0.0
   dj-database-url==2.1.0
   django-cloudinary-storage==0.3.0
   cloudinary==1.36.0
   python-dotenv==1.0.1

   ğŸ”¸ CRÃ‰ER : runtime.txt (Ã  la racine du projet Django)
   ğŸ“ Emplacement : /workspace/projets/tp_django/runtime.txt
   python-3.13

   ğŸ”¸ CRÃ‰ER : Procfile (Ã  la racine du projet Django, SANS extension)
   ğŸ“ Emplacement : /workspace/projets/tp_django/Procfile
   web: python manage.py collectstatic --noinput && gunicorn tp_django.wsgi

   âš ï¸ IMPORTANT : AprÃ¨s avoir crÃ©Ã© le .env, redÃ©marrer le serveur local :
   ğŸ“ Terminal :
   python manage.py runserver

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš‚ 2. CONFIGURATION DE RAILWAY (MySQL)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

2.1. Ã‰tapes sur Railway.app :
   âœ… CrÃ©er un nouveau projet
   âœ… Connecter le repository GitHub
   âœ… Ajouter un service MySQL Database
   âœ… Attendre que MySQL soit provisionnÃ©

2.2. Variables d'environnement Ã  configurer sur Railway :
   DEBUG=False
   SECRET_KEY=your-secret-key-here
   ALLOWED_HOSTS=tpdjango-production.up.railway.app
   CSRF_TRUSTED_ORIGINS=https://tpdjango-production.up.railway.app
   
   # Variables MySQL (automatiques via Railway) :
   MYSQL_URL=mysql://user:password@host:port/database
   MYSQLDATABASE=railway
   MYSQLUSER=root
   MYSQLPASSWORD=generated-password
   MYSQLHOST=containers-us-west-xxx.railway.app
   MYSQLPORT=6543

2.3. Configuration du domaine :
   âœ… Domaine gÃ©nÃ©rÃ© : tpdjango-production.up.railway.app
   âœ… HTTPS automatique avec certificat SSL

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â˜ï¸ 3. CONFIGURATION DE CLOUDINARY (STOCKAGE D'IMAGES)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

3.1. CrÃ©ation du compte Cloudinary :
   âœ… Inscription sur cloudinary.com
   âœ… RÃ©cupÃ©ration des identifiants API

3.2. Installation des packages :
   poetry add django-cloudinary-storage
   poetry add cloudinary

3.3. Configuration dans settings.py :

   ğŸ“ Fichier : tp_django/settings.py
   
   ğŸ”¸ Ã‰TAPE 1 : Ajouter les imports Cloudinary (aprÃ¨s les imports existants)
   import cloudinary
   import cloudinary.uploader
   import cloudinary.api

   ğŸ”¸ Ã‰TAPE 2 : Modifier l'ordre dans INSTALLED_APPS (TRÃˆS IMPORTANT)
   INSTALLED_APPS = [
       'django.contrib.staticfiles',  # â† DOIT Ãªtre en PREMIER pour les fichiers statiques
       'cloudinary_storage',          # â† Pour les mÃ©dias seulement
       'cloudinary',                  # â† AprÃ¨s cloudinary_storage
       # ... garder toutes les autres apps existantes
   ]

   ğŸ”¸ Ã‰TAPE 3 : Ajouter la configuration Cloudinary (Ã  la fin du fichier, avant DEFAULT_AUTO_FIELD)
   # Configuration Cloudinary
   cloudinary.config(
       cloud_name=os.environ.get('CLOUDINARY_CLOUD_NAME'),
       api_key=os.environ.get('CLOUDINARY_API_KEY'),
       api_secret=os.environ.get('CLOUDINARY_API_SECRET'),
       secure=True
   )

   CLOUDINARY_STORAGE = {
       'CLOUD_NAME': os.environ.get('CLOUDINARY_CLOUD_NAME', ''),
       'API_KEY': os.environ.get('CLOUDINARY_API_KEY', ''),
       'API_SECRET': os.environ.get('CLOUDINARY_API_SECRET', ''),
   }

   ğŸ”¸ Ã‰TAPE 4 : Ajouter la configuration de stockage pour production
   # Utiliser Cloudinary en production pour les mÃ©dias uniquement
   if not DEBUG:
       DEFAULT_FILE_STORAGE = 'cloudinary_storage.storage.MediaCloudinaryStorage'

3.4. Variables d'environnement Cloudinary sur Railway :
   CLOUDINARY_CLOUD_NAME=dnlraecua
   CLOUDINARY_API_KEY=635285162275731
   CLOUDINARY_API_SECRET=qhOM0uYjiEfCFRuNWwAB1-9a9d4

3.5. ğŸ”¥ MODIFICATION CRUCIALE DU MODÃˆLE Article :

   ğŸ“ Fichier : blog/models.py
   
   ğŸ”¸ Ã‰TAPE 1 : Ajouter l'import Cloudinary (en haut du fichier)
   from django.db import models
   from django.contrib.auth.models import User
   from cloudinary.models import CloudinaryField  # â† AJOUTER cette ligne

   ğŸ”¸ Ã‰TAPE 2 : Remplacer le champ image dans la classe Article
   AVANT (stockage local) :
   image = models.ImageField(upload_to='articles/', blank=True, null=True)

   APRÃˆS (Cloudinary) :
   image = CloudinaryField('image', folder='articles', blank=True, null=True)

   ğŸ”¸ Ã‰TAPE 3 : CrÃ©er et appliquer la migration
   ğŸ“ Dans le terminal, exÃ©cuter :
   python manage.py makemigrations
   python manage.py migrate

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ 4. DÃ‰PLOIEMENT ET RÃ‰SOLUTION DES PROBLÃˆMES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


4.1. ProblÃ¨mes rencontrÃ©s et solutions :

   ğŸ› ProblÃ¨me : Fichiers CSS avec MIME type 'text/html'
   âœ… Solution : Corriger l'ordre dans INSTALLED_APPS et Procfile
   
   ğŸ› ProblÃ¨me : Cloudinary interfÃ¨re avec collectstatic
   âœ… Solution : Mettre 'django.contrib.staticfiles' AVANT 'cloudinary_storage'
   
   ğŸ› ProblÃ¨me : Images stockÃ©es localement au lieu de Cloudinary
   âœ… Solution : Changer ImageField vers CloudinaryField dans models.py

4.2. Configuration finale STATICFILES_DIRS :
   
   ğŸ“ Fichier : tp_django/settings.py
   
   ğŸ”¸ Trouver STATICFILES_DIRS et le modifier/remplacer par :
   STATICFILES_DIRS = [
       BASE_DIR / 'static',                  # Dossier principal
       BASE_DIR / 'tp_django' / 'static',    # Dossier de sauvegarde
   ]


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

4.3. Ajout du favicon :
   
   ğŸ”¸ Ã‰TAPE 1 : CrÃ©er les fichiers favicon
   ğŸ“ CrÃ©er dans : static/favicon.ico et static/favicon.svg
   
   ğŸ”¸ Ã‰TAPE 2 : Ajouter dans base.html
   ğŸ“ Fichier : tp_django/templates/base.html
   ğŸ“ Ajouter aprÃ¨s <title> et avant les autres <link> :
   
   <!-- Favicons -->
   {% load static %}
   <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
   <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ 5. FICHIERS CRÃ‰Ã‰S ET MODIFIÃ‰S - RÃ‰CAPITULATIF COMPLET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

5.1. ğŸ“„ Fichiers de dÃ©ploiement crÃ©Ã©s :
   â”œâ”€â”€ requirements.txt (dÃ©pendances Python + python-dotenv)
   â”œâ”€â”€ runtime.txt (version Python 3.13)
   â”œâ”€â”€ Procfile (commandes Railway)
   â”œâ”€â”€ .env (variables d'environnement locales)
   â”œâ”€â”€ .gitignore (exclure .env du git)
   â””â”€â”€ README.md (documentation projet)

5.2. ğŸ”§ Fichiers de configuration modifiÃ©s :
   â”œâ”€â”€ tp_django/settings.py (production + Cloudinary)
   â””â”€â”€ blog/models.py (CloudinaryField)

5.3. ğŸ¨ Assets statiques crÃ©Ã©s :
   â”œâ”€â”€ static/favicon.ico (icÃ´ne navigateur)
   â”œâ”€â”€ static/favicon.svg (version vectorielle)
   â”œâ”€â”€ static/blog/style.css (styles blog)
   â”œâ”€â”€ static/accounts/style.css (styles authentification)
   â””â”€â”€ static/polls/style.css (styles sondages)


âœ… RÃ‰SULTAT FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸŒ Application dÃ©ployÃ©e sur : https://tpdjango-production.up.railway.app

ğŸ† FonctionnalitÃ©s opÃ©rationnelles :
   âœ… Blog avec articles et commentaires
   âœ… SystÃ¨me de sondages interactifs  
   âœ… Authentification complÃ¨te (login/signup/dashboard)
   âœ… API REST avec JWT et documentation Swagger
   âœ… Base de donnÃ©es MySQL sur Railway
   âœ… Stockage d'images persistant avec Cloudinary
   âœ… Interface responsive (mobile/tablet/desktop)
   âœ… Favicon personnalisÃ©
   âœ… HTTPS et domaine sÃ©curisÃ©
   âœ… Tests avec couverture 100%

ğŸ¯ Technologies utilisÃ©es :
   - Django 5.2.8 + DRF + JWT
   - MySQL (Railway)
   - Cloudinary (stockage images)
   - Bootstrap 5.3.6 (responsive)
   - Gunicorn + WhiteNoise (production)
   - Railway (hÃ©bergement)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    FIN DU GUIDE
                              CrÃ©Ã© le 2 dÃ©cembre 2025
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•